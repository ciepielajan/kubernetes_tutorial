<html lang="pl">
    <head>
        <meta charset="utf-8">
        <title>Dokumentacja do lekcji</title>
	<style>
		html { font-size: 100%; overflow-y: scroll; -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; } body { color: #444; font-family: Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif; font-size: 12px; line-height: 1.7; padding: 1em; margin: auto; max-width: 42em; background: #fefefe; } a { color: #0645ad; text-decoration: none; } a:visited { color: #0b0080; } a:hover { color: #06e; } a:active { color: #faa700; } a:focus { outline: thin dotted; } *::-moz-selection { background: rgba(255, 255, 0, 0.3); color: #000; } *::selection { background: rgba(255, 255, 0, 0.3); color: #000; } a::-moz-selection { background: rgba(255, 255, 0, 0.3); color: #0645ad; } a::selection { background: rgba(255, 255, 0, 0.3); color: #0645ad; } p { margin: 1em 0; } img { max-width: 100%; } h1, h2, h3, h4, h5, h6 { color: #111; line-height: 125%; margin-top: 2em; font-weight: normal; } h4, h5, h6 { font-weight: bold; } h1 { font-size: 2.5em; } h2 { font-size: 2em; } h3 { font-size: 1.5em; } h4 { font-size: 1.2em; } h5 { font-size: 1em; } h6 { font-size: 0.9em; } blockquote { color: #666666; margin: 0; padding-left: 3em; border-left: 0.5em #EEE solid; } hr { display: block; height: 2px; border: 0; border-top: 1px solid #aaa; border-bottom: 1px solid #eee; margin: 1em 0; padding: 0; } pre, code, kbd, samp { color: #000; font-family: monospace, monospace; _font-family: 'courier new', monospace; font-size: 0.98em; } pre { white-space: pre; white-space: pre-wrap; word-wrap: break-word; } b, strong { font-weight: bold; } dfn { font-style: italic; } ins { background: #ff9; color: #000; text-decoration: none; } mark { background: #ff0; color: #000; font-style: italic; font-weight: bold; } sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; } sup { top: -0.5em; } sub { bottom: -0.25em; } ul, ol { margin: 1em 0; padding: 0 0 0 2em; } li p:last-child { margin-bottom: 0; } ul ul, ol ol { margin: .3em 0; } dl { margin-bottom: 1em; } dt { font-weight: bold; margin-bottom: .8em; } dd { margin: 0 0 .8em 2em; } dd:last-child { margin-bottom: 0; } img { border: 0; -ms-interpolation-mode: bicubic; vertical-align: middle; } figure { display: block; text-align: center; margin: 1em 0; } figure img { border: none; margin: 0 auto; } figcaption { font-size: 0.8em; font-style: italic; margin: 0 0 .8em; } table { margin-bottom: 2em; border-bottom: 1px solid #ddd; border-right: 1px solid #ddd; border-spacing: 0; border-collapse: collapse; } table th { padding: .2em 1em; background-color: #eee; border-top: 1px solid #ddd; border-left: 1px solid #ddd; } table td { padding: .2em 1em; border-top: 1px solid #ddd; border-left: 1px solid #ddd; vertical-align: top; } .author { font-size: 1.2em; text-align: center; } @media only screen and (min-width: 480px) { body { font-size: 14px; } } @media only screen and (min-width: 768px) { body { font-size: 16px; } } @media print { * { background: transparent !important; color: black !important; filter: none !important; -ms-filter: none !important; } body { font-size: 12pt; max-width: 100%; } a, a:visited { text-decoration: underline; } hr { height: 1px; border: 0; border-bottom: 1px solid black; } a[href]:after { content: " (" attr(href) ")"; } abbr[title]:after { content: " (" attr(title) ")"; } .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; } pre, blockquote { border: 1px solid #999; padding-right: 1em; page-break-inside: avoid; } tr, img { page-break-inside: avoid; } img { max-width: 100% !important; } @page :left { margin: 15mm 20mm 15mm 10mm; } @page :right { margin: 15mm 10mm 15mm 20mm; } p, h2, h3 { orphans: 3; widows: 3; } h2, h3 { page-break-after: avoid; } }
	</style>
    </head>
    <body>
	<h3 id="uruchomienie-klastra-za-pomocą-kubeadm-na-maszynach-virtualboxa">Uruchomienie klastra za pomocą Kubeadm na maszynach VirtualBoxa</h3>
<h4 id="przygotowanie-maszyny-wirtualnej-w-virtualbox">Przygotowanie maszyny wirtualnej w VirtualBox</h4>
<h5 id="instalacja-ubuntu-18.04">Instalacja Ubuntu 18.04</h5>
<ul>
<li>Pobierz plik *.iso z systemem Ubuntu ze strony z <a href="http://old-releases.ubuntu.com/releases/bionic/">archiwalnymi obrazami</a>.</li>
</ul>
<p>W lekcji użyto pliku <code>ubuntu-18.04-server-amd64.iso</code>- czyli <a href="http://old-releases.ubuntu.com/releases/bionic/ubuntu-18.04-server-amd64.iso">Ubuntu 18.04 64bit</a></p>
<ul>
<li>Utwórz nową maszynę wirtualną. Jeśli posiadasz wystarczającą ilość zasobów, to ustaw dla maszyny wirtualnej 2 procesory.</li>
<li>Skonfiguruj drugi interfejs sieciowy jako &quot;Host Only&quot;. Zapewni on łączność z maszyną hosta.</li>
<li>Przejdź przez instalację systemu. W trakcie instalacji zaznacz by zainstalował się serwer SSH (ewentualnie zainstaluj go już po instalacji).</li>
<li>Zaktualizuj system do najnowszej wersji.</li>
<li><p>Wyłącz partycję wymiany w systemie operacyjnym:</p>
<pre><code>sudo swapoff
sudo swapoff -a</code></pre></li>
<li><p>Ustaw sieć w systemie tak by automatycznie pobierać adres IP na oba interfejsy sieciowe (edycja pliku w katalogu <code>/etc/netplan</code>).</p></li>
</ul>
<h5 id="budowa-klastra">Budowa klastra</h5>
<ul>
<li>Skopiuj maszynę wirtualną utworzoną w poprzednim punkcie trzy razy. Nazwij je w dowolny sposób, wybierz opcję ponownego wygenerowania adresów MAC kart sieciowych.</li>
</ul>
<h5 id="konfiguracja-maszyn-i-instalacja-oprogramowania">Konfiguracja maszyn i instalacja oprogramowania</h5>
<ul>
<li>Połącz się do każdej maszyny za pomocą SSH.</li>
<li>Skonfiguruj nazwę dla każdej z maszyn edytując pliki <code>/etc/hostname</code> i <code>/etc/hosts</code>. Uruchom ponownie maszynę.</li>
<li><p>Zainstaluj dokera:</p>
<pre><code>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot;
sudo apt update &amp;&amp; sudo apt install docker-ce</code></pre></li>
<li><p>Zainstaluj Kubeadma i inne komponenty:</p>
<pre><code>sudo apt-get update &amp;&amp; sudo apt-get install -y apt-transport-https &amp;&amp; curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
echo &quot;deb http://apt.kubernetes.io/ kubernetes-xenial main&quot; | sudo tee -a /etc/apt/sources.list.d/kubernetes.list &amp;&amp; sudo apt-get update
sudo apt install -y kubeadm  kubelet kubernetes-cni</code></pre>
<h5 id="instalacja-pierwszego-węzła---mastera">Instalacja pierwszego węzła - mastera:</h5>
<pre><code>sudo kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=&lt;Adres IP na interfejsie host-only&gt;</code></pre>
<h5 id="podłączenie-do-klastra-pozostałych-węzłów">Podłączenie do klastra pozostałych węzłów:</h5>
<p>Użyj polecenia wypisanego na końcu logów z polecenia <code>kubeadm init</code> na każdym węźle, który chcesz dodać.</p>
<pre><code>kubeadm join &lt;Adres IP na interfejsie host-only&gt;:6443 --token &lt;token&gt; --discovery-token-ca-cert-hash sha256:&lt;hash&gt;</code></pre>
<h5 id="końcowa-konfiguracja-mastera">Końcowa konfiguracja mastera</h5></li>
<li>Kubeconfig administratora klastra znajduje się w katalogu: <code>/etc/kubernetes/admin.conf</code>. Skonfiguruj kubectl'a aby używał tego pliku.</li>
<li><p>Instalacja pluginu sieciowego <code>flannel</code>:</p>
<pre><code>kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</code></pre></li>
<li><p>Zmiana roli węzła master na taką, która pozwoli uruchamiać na nim pody:</p>
<pre><code>kubectl taint nodes --all node-role.kubernetes.io/master-</code></pre></li>
<li><p>Uruchomienie polecenie <code>kubectl get nodes</code> powinno zwrócić trzy węzły w stanie <code>Ready</code>. Klaster jest gotowy.</p></li>
</ul>
<h4 id="powiązana-literatura">Powiązana literatura</h4>
<ul>
<li><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">Wstępna konfiguracja Kubeadma</a></li>
<li><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/">Instalacja klastra Kubeadm</a></li>
<li><a href="https://github.com/kubernetes/kubeadm">Projekt kubeadm na githubie</a></li>
<li><a href="https://kubernetes.io/docs/concepts/cluster-administration/networking/">Pluginy sieciowe w kubernetesie</a></li>
</ul>
    </body>
</html>
